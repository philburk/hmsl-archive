\ Use HMSL Event Buffer as wakeup queue.\ Authors: Ron Kuivala, Phil Burk\ Based in part on FORMULA by Ron Kuivala and  David Anderson\ Copyright 1991 Ron Kuivala, Phil Burk, David AndersonANEW TASK-SLEEP: WAKEUP	( CB -- ; transfer CB from sleeping to active list )  	  sleeping->active  \ called by event buffer so watch out;: SET.ALARM ( dt -- ; post message to wake up calling process )	who @ ..@ cb_time_pos +	dup 	who @ ..! cb_time_pos	who @ 	' wakeup rot 	cause			\ Cause ( data cfa time )		;: (SLEEP ( -- ; remove calling process from active process list)	rr.next.process >r	who @ active->sleeping	\ tie it to the sleeping list	r> mt.switch.to;	: SLEEP.FOR ( dt -- , called by process to sleep for a while )	who @ main-process @ <>	IF		disable.clock.int >r			rr.next.process >r			who @ active->sleeping	\ tie it to the sleeping list			set.alarm			r> mt.switch.to		r> restore.interrupt		rr.life&death	ELSE		drop	THEN;