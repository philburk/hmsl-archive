\ Conditional Compilation\\ *********************************************************************\ * HMSL Forth System                                                 *\ * Author: Phil Burk                                                 *\ * Copyright 1989 Phil Burk , All Rights Reserved                    *\ *********************************************************************\\ MOD: PLB 10/9/90 Removed check for ?TERMINAL in .ELSEdecimalanew task-cond_comp( Conditional Compilation ): .THEN ( -- , Terminator for conditional compiler. ); IMMEDIATE: GRAB.NEXT.LINE  ( -- , get next line from file since word doesn't %Q)	FSOURCE @	IF FQUERY	ELSE QUERY	THEN	at-eof @	IF ." .IF not balanced!" abort	THEN;: .ELSE  ( -- , Ignore code until .THEN or .ELSE hit. )	BEGIN		false >r		32 WORD dup c@ 0=		IF drop GRAB.NEXT.LINE		ELSE   ( -- string ) findnfa			IF	( -- nfa )				name> dup ['] .THEN =  ( -- cfa flag )				over [ latest name> ] aliteral = OR    ( or .ELSE ) ( -- cfa flag )				IF rdrop true >r  ( change done? )				THEN			THEN drop		THEN 		r> ( done? )     UNTIL; IMMEDIATE: .IF ( flag -- , interpret what follows if defined. )	0=	IF  [COMPILE] .ELSE	THEN; IMMEDIATE: EXISTS? ( <name> -- flag , true if defined )    32 word find    swap drop; immediate: .NEED ( <name> -- start compiling if not found )    [compile] exists? not [compile] .IF;: $REMOVE" ( $string -- , remove trailing " )    dup count 1- + c@ ascii " =    IF cr ." Removing extraneous " ascii " emit ."   from name!" cr        dup c@ 1- swap c!    ELSE drop    THEN;