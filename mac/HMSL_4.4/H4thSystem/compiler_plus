\ Compiler Additions & Optimizations\\ *********************************************************************\ * HMSL Forth System                                                 *\ * Author: Phil Burk                                                 *\ * Copyright 1989 Phil Burk , All Rights Reserved                    *\ *********************************************************************\\ 00001 PLB 11/20/91 Remove code to SET size.decimalANEW TASK-COMPILER_PLUSvariable CSP: !CSP  ( -- , save current stack pointer )	sp@ csp !;: ?CSP  ( -- , check stack pointer to make sure it is the same as before )	sp@ csp @ -	IF	>newline ." Stack imbalance in " LATEST ID. CR		." Check for unbalanced conditionals, eg. IF but no THEN" CR abort	THEN;: ?ROOM  ( -- , check to make sure that there is enough room in dict. )	code-limit @ here - 512 <	IF  >newline ." Running out of dictionary space.  Expand dictionary!"		cr abort	THEN;: ALLOT  ( -- , add room check )	ALLOT ?ROOM;: :  ( <name> -- , redefine : to save here )	:  ( do old )	!csp;: ;  ( -- , redefine ; , set size field )	[compile] ;	?csp ?room; immediate: PUSHTIB  ( -- , push contents of TIB onto return stack )	r>  ( return address )	tib #tib @ 3 + cell/	BEGIN dup 0>	WHILE swap dup @ >r cell+ 		swap 1-	REPEAT 2drop	#tib @ >r	>in @ >r	>r  ( return address );: PULLTIB  ( -- , restore TIB from return stack )	r> ( return address )	r> >in !	r> #tib !	#tib @ 3 + cell/	dup>r cell* cell- tib + r> 	BEGIN dup 0>	WHILE swap r> over ! cell-		swap 1-	REPEAT 2drop	>r;: >TIB ( addr count -- , load string into TIB )	dup #tib !	tib swap cmove	>in off;: ($INTERPRET)  ( addr count -- ???? )	>tib	interpret;: $INTERPRET  ( addr count -- ???? )	pushtib	($interpret)	pulltib;: % ( <bin#> -- )    base @ binary    bl word dup number?    IF drop nip state @        IF [compile] literal        ELSE swap        THEN        base !    ELSE ." % - not a binary number! " count type        base ! abort    THEN; immediate