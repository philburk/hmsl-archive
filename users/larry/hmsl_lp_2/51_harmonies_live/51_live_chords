\  chords for 51_liveanew task-51_live_chords\ ob.player chord-player is defined in constantsob.instrument chord-instrumentv: chord-repeat-flagv: chord-first-notev: chords-on?v: chord-transpose-factorv: chord-drop-out-factor: CHORD-PLAYER-START.FUNC { player | coll -- } 	\ pick possibility of chord not playing for section	25 curr-section @ 25 - abs -  	25 choose < 	IF		true chord to: voices-on?		1 chord put.value: cg-voices-on	ELSE		false chord to: voices-on?		0 chord put.value: cg-voices-on	THEN	0 chord-first-note !	\ first set preset for this section	chord 1+ midi.channel!	chord #-presets choose 	ed.at: 51-presets midi.preset	\ now get the current collection, and add the shapes to this player	curr-section @ 	at: collection-list	-> coll	coll many: []	player set.many: []	many: coll 0 DO		i coll at: []		i player put: []	LOOP	\ pick a random octave, and select a drop out factor	3 choose chord-transpose-factor ! ;: CHORD-PLAYER-REPEAT.FUNC { player | coll -- }	0 chord-repeat-flag !	0 chord-first-note !;		: CHORD-PLAYER-DUR.FUNC { el shape -- }	arp-pulse;: INIT.CHORD-PLAYER	 max-shapes new: chord-player	1 put.repeat: chord-player	chord-instrument put.instrument: chord-player	'c chord-player-dur.func put.dur.function: chord-player	'c chord-player-start.func put.start.function: chord-player	'c chord-player-repeat.func put.repeat.function: chord-player;: CHORD.VEL { el -- }	\ if arps is turned off, set all velocities to be zero	chord at: voices-on?	IF		el 0= chord-first-note @ 0= and		IF			90 70 wchoose		ELSE			el 0= 			IF				70 50 wchoose				ELSE			50 30 wchoose			THEN		THEN		chord at: voice-loudness 100 */	ELSE		0	THEN;: CHORD-INSTRUMENT.FUNC {  el shape ins | dur -- }	ins get.channel: []  midi.channel!	midi.lastoff	\ only play on first note of each shape, and if shape is big enough	shape many: [] 2 >	el 0= and	IF		\ first pick duration of chord		shape many: [] 1+ 1 wchoose arp-pulse * -> dur		shape many: [] 0 		DO			7 choose 4 < 			IF \  chance of using one of the notes in the shape				i shape at: [] 	chord-transpose-factor @ 12 * + 				el chord.vel dur midi.noteon.for			THEN		LOOP		1 chord-first-note ! \ set for purposes of velocity	THEN;	: INIT.CHORD-INSTRUMENT	0 put.offset: chord-instrument	chord 1+ put.channel: chord-instrument	'c chord-instrument.func put.on.function: chord-instrument;: INIT.CHORDS	init.chord-player	init.chord-instrument;: TERM.CHORDS	free: chord-player	free: chord-instrument;if.forgotten term.chords