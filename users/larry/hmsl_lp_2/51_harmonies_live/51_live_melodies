\ 51_melodiesanew task-51_live_melodiesv: prev-dur-1v: prev-dur-2v: pulse-1v: pulse-2v: mel-1-transpose-factorv: mel-2-transpose-factor: MELODY-1-JOB.START.FUNCTION { job  | total-time  -- }	triangle-value  	25 choose >	IF		true mel-1 to: voices-on?		1 mel-1 put.value: cg-voices-on	ELSE		false mel-1  to: voices-on?		0 mel-1  put.value: cg-voices-on	THEN	collection-time @ arp-pulse *  -> total-time	total-time	arp-pulse 	triangle-value 6 choose / \ total-time arp-pulse inc	+ \ total-time arp-pulse+inc	arp-pulse max	/ 	dup pulse-1 !	dup prev-dur-1 !	job put.duration: []	mel-1 1+ midi.channel!	mel-1 #-presets choose 	ed.at: 51-presets midi.preset	3 choose mel-1-transpose-factor !;	: MELODY-1-JOB.FUNCTION { job  | shape el -- }	 mel-1 at: voices-on? 	IF		mel-1 1+ midi.channel!		midi.lastoff		many: arp-player		choose at: arp-player		-> shape		shape many: [] choose -> el		el shape at: [] \ pitch		mel-1-transpose-factor @ 12 * +		127 dup shape many: [] / el * - dup 2 * 3 / wchoose \ decreasing velocity as shape goes on		mel-1  at: voice-loudness 100 */ \ multiply it by the velocity-scalar		  midi.noteon		\ now pick new duration, some prob. that it will be same as last one		\ towards the middle of the piece, less equal values...		30 choose triangle-value >		IF			prev-dur-1 @ 			job put.duration: []		ELSE 			\ pick a new duration			4 1 wchoose pulse-1 @ * 			dup prev-dur-1 ! 			job put.duration: []		THEN	THEN;: MELODY-2-JOB.START.FUNCTION { job  | total-time  -- }	triangle-value  	40 choose >	IF		true mel-2 to: voices-on?		1 mel-2 put.value: cg-voices-on	ELSE		false mel-2  to: voices-on?		0 mel-2  put.value: cg-voices-on	THEN	draw.voices.on	collection-time @ arp-pulse *  -> total-time	total-time	arp-pulse 	triangle-value 4 choose  / \ total-time arp-pulse inc	+ \ total-time arp-pulse+inc	arp-pulse max	/ 	dup pulse-2 !	dup prev-dur-2 !	job put.duration: []	mel-2 1+ midi.channel!	mel-2 #-presets choose 	ed.at: 51-presets midi.preset	3 choose 1- mel-2-transpose-factor !;	: MELODY-2-JOB.FUNCTION { job  | shape el -- }	 mel-2 at: voices-on? 	IF		mel-2 1+ midi.channel!		midi.lastoff		many: arp-player		choose at: arp-player		-> shape		\ first do pitch		 shape many: [] choose -> el		el shape at: [] \ pitch		mel-2-transpose-factor @ 12 * +		\ now do loudness		127  shape many: [] / 		el * dup 2 * 3 / wchoose \ increasing velocity as shape goes on		mel-2  at: voice-loudness 100 */ \ multiply it by the velocity-scalar		midi.noteon		\ now pick new duration, some prob. that it will be same as last one		\ towards the middle of the piece, less equal values...		18 choose triangle-value >		IF			prev-dur-2 @ job put.duration: []		ELSE 			\ pick a new duration			6 1 wchoose pulse-2 @ * 			dup prev-dur-2 ! 			job put.duration: []		THEN	THEN;	: INIT.MELODIES	1 new: melody-1-job	'c melody-1-job.function add: melody-1-job	'c melody-1-job.start.function put.start.function: melody-1-job	1 new: melody-2-job	'c melody-2-job.function add: melody-2-job	'c melody-2-job.start.function put.start.function: melody-2-job;: TERM.MELODIES	free: melody-1-job	free: melody-2-job;if.forgotten term.melodies